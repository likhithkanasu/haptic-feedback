<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Haptic Feedback Receiver</title>
</head>
<body>
    <h1>Haptic Feedback Receiver</h1>
    <button id="activateVibration">Activate Vibration</button>
    <p id="status">Waiting for vibration signal...</p>

    <script>
        let vibrationAllowed = false;

        // User must tap this button to allow vibration
        document.getElementById("activateVibration").addEventListener("click", () => {
            vibrationAllowed = true;
            document.getElementById("status").innerText = "Ready to receive vibration!";
        });

        const socket = new WebSocket("wss://76cf-202-140-34-158.ngrok-free.app"); // Use your ngrok URL

        socket.onopen = () => {
            console.log("Connected to WebSocket Server");
        };

        socket.onmessage = (event) => {
            if (vibrationAllowed) {
                // Ensure event.data is a string before trimming
                let data = typeof event.data === "string" ? event.data.trim() : String(event.data).trim();
                let count = parseInt(data, 10); // Convert string to number safely

                if (!isNaN(count) && count > 0) {
                    console.log(`Received: ${count}`);
                    navigator.vibrate(Array(count).fill(300)); // Vibrate in bursts
                    document.getElementById("status").innerText = `Vibrating ${count} times!`;
                } else {
                    console.warn("Invalid data received:", event.data);
                    document.getElementById("status").innerText = "Error: Invalid vibration signal!";
                }
            } else {
                console.warn("Vibration blocked! User must activate first.");
            }
        };
    </script>
</body>
</html>
